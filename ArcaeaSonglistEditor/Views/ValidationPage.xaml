<Page x:Class="ArcaeaSonglistEditor.Views.ValidationPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:viewModels="clr-namespace:ArcaeaSonglistEditor.ViewModels"
      Title="验证报告"
      Width="Auto"
      Height="Auto">


    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 工具栏 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,8">
            <TextBlock Text="验证报告" Style="{StaticResource PageTitleText}" />
            <WrapPanel ItemHeight="32">
                <Button Content="验证"
                        Margin="0,0,8,8"
                        Style="{StaticResource PrimaryButton}"
                        Command="{Binding ValidateCommand}" />
                <CheckBox Content="严格验证模式"
                          Margin="0,0,12,8"
                          VerticalAlignment="Center"
                          IsChecked="{Binding StrictValidationMode}" />
                <Button Content="选择Songs文件夹"
                        Margin="0,0,8,8"
                        Command="{Binding SelectSongsFolderCommand}" />
                <Button Content="导出报告"
                        Margin="0,0,8,8"
                        Command="{Binding ExportReportCommand}" />
            </WrapPanel>
        </StackPanel>
        
        <!-- 当前选择的文件夹路径 -->
        <Border Grid.Row="1" 
                Background="{StaticResource BrushSurface2}"
                BorderBrush="{StaticResource BrushBorder}"
                BorderThickness="1"
                CornerRadius="{StaticResource RadiusSm}"
                Padding="8"
                Margin="0,0,0,12"
                HorizontalAlignment="Stretch">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="当前Songs文件夹: "
                           VerticalAlignment="Center"
                           FontSize="12" />
                <TextBlock Text="{Binding SongsFolderPath, FallbackValue='未选择（将尝试自动检测）'}"
                           VerticalAlignment="Center"
                           FontSize="12"
                           FontWeight="SemiBold"
                           TextTrimming="CharacterEllipsis"
                           MaxWidth="300" />
            </StackPanel>
        </Border>

        <!-- 验证结果 -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- 验证摘要 -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BrushSurface2}"
                    BorderBrush="{StaticResource BrushBorder}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusSm}"
                    Padding="12"
                    Margin="0,0,0,12">
                <TextBlock Text="{Binding ValidationSummary}"
                           TextWrapping="Wrap"
                           FontSize="12" />
            </Border>

            <!-- 错误和警告列表 -->
            <TabControl Grid.Row="1">
                <TabItem Header="错误">
                    <DataGrid ItemsSource="{Binding Errors}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="序号" 
                                               Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Converter={StaticResource RowIndexConverter}}"
                                               Width="60" />
                            <DataGridTextColumn Header="错误信息" 
                                               Binding="{Binding}"
                                               Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>
                
                <TabItem Header="警告">
                    <DataGrid ItemsSource="{Binding Warnings}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="序号" 
                                               Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Converter={StaticResource RowIndexConverter}}"
                                               Width="60" />
                            <DataGridTextColumn Header="警告信息" 
                                               Binding="{Binding}"
                                               Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Page>
