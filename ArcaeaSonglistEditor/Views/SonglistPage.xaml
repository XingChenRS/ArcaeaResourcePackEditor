<Page x:Class="ArcaeaSonglistEditor.Views.SonglistPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:viewModels="clr-namespace:ArcaeaSonglistEditor.ViewModels"
      xmlns:models="clr-namespace:ArcaeaSonglistEditor.Core.Models;assembly=ArcaeaSonglistEditor.Core"
      Title="歌曲列表"
      Width="Auto"
      Height="Auto">


    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 工具栏 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="歌曲列表" Style="{StaticResource PageTitleText}" />
            <WrapPanel ItemHeight="32">
                <TextBox Width="240"
                         Margin="0,0,8,8"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
                <Button Content="搜索"
                        Margin="0,0,8,8"
                        Command="{Binding SearchCommand}" />
            </WrapPanel>

            <WrapPanel ItemHeight="32">
                <Button Content="添加歌曲" Margin="0,0,8,8" Command="{Binding AddSongCommand}" />
                <Button Content="编辑歌曲" Margin="0,0,8,8" Command="{Binding EditSongCommand}" />
                <Button Content="删除歌曲" Margin="0,0,8,8" Command="{Binding DeleteSongCommand}" />
                <Button Content="移除限制" Margin="0,0,8,8" Command="{Binding RemoveRestrictionsCommand}" />
                <Button Content="移除所有限制" Margin="0,0,8,8" Command="{Binding RemoveAllRestrictionsCommand}" />
                <Button Content="导入" Margin="0,0,8,8" Command="{Binding ImportSonglistCommand}" />
                <Button Content="导出" Margin="0,0,8,8" Command="{Binding ExportSonglistCommand}" />
            </WrapPanel>
        </StackPanel>

        <!-- 主从布局：左侧列表 / 右侧详情 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" MinWidth="380" />
                <ColumnDefinition Width="6" />
                <ColumnDefinition Width="*" MinWidth="420" />
            </Grid.ColumnDefinitions>

            <!-- 左：歌曲列表 -->
            <DataGrid Grid.Column="0"
                      AutoGenerateColumns="False"
                      ItemsSource="{Binding Songs}"
                      SelectedItem="{Binding SelectedSong}"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserReorderColumns="False"
                      CanUserResizeRows="False"
                      CanUserSortColumns="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="120" />
                    <DataGridTextColumn Header="标题" Binding="{Binding TitleLocalized.English}" Width="220" />
                    <DataGridTextColumn Header="艺术家" Binding="{Binding Artist}" Width="180" />
                    <DataGridTextColumn Header="BPM" Binding="{Binding Bpm}" Width="90" />
                    <DataGridTextColumn Header="曲包" Binding="{Binding Set}" Width="120" />
                    <DataGridTextColumn Header="阵营" Binding="{Binding Side}" Width="90" />
                </DataGrid.Columns>
            </DataGrid>

            <GridSplitter Grid.Column="1"
                         Width="6"
                         Background="{StaticResource BrushBorder}"
                         HorizontalAlignment="Stretch"
                         ShowsPreview="True" />

            <!-- 右：详情编辑 -->
            <Border Grid.Column="2"
                    Background="{StaticResource BrushSurface2}"
                    BorderBrush="{StaticResource BrushBorder}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource RadiusSm}"
                    Padding="12">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="歌曲详情"
                               Style="{StaticResource SectionTitleText}" />

                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Auto">
                        <StackPanel IsEnabled="{Binding HasSelectedSong}">
                            <GroupBox Header="基础信息">
                                <Grid Margin="4">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Link Play ID（idx，可选）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedSong.Index, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="歌曲ID（id）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedSong.Id, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="标题（英文，title_localized.en）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedSong.TitleLocalized.English, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="艺术家（artist）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedSong.Artist, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="BPM（显示，bpm）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding SelectedSong.Bpm, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="5" Grid.Column="0" Text="基准 BPM（bpm_base）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding SelectedSong.BpmBase, UpdateSourceTrigger=PropertyChanged}" />
                                </Grid>
                            </GroupBox>

                            <GroupBox Header="分类 / 背景 / 预览">
                                <Grid Margin="4">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="曲包ID（set）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedSong.Set, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="阵营（side）" Style="{StaticResource FieldLabelText}" />
                                    <ComboBox Grid.Row="1" Grid.Column="1"
                                              SelectedValue="{Binding SelectedSong.Side}"
                                              SelectedValuePath="Tag">
                                        <ComboBoxItem Content="光芒侧" Tag="{x:Static models:ArcaeaSide.Light}" />
                                        <ComboBoxItem Content="纷争侧" Tag="{x:Static models:ArcaeaSide.Conflict}" />
                                        <ComboBoxItem Content="消色侧" Tag="{x:Static models:ArcaeaSide.Colorless}" />
                                    </ComboBox>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="背景（bg）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedSong.Background, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="反转背景（bg_inverse）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedSong.BackgroundInverse, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="预览起始（audioPreview，ms）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding SelectedSong.AudioPreview, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="5" Grid.Column="0" Text="预览结束（audioPreviewEnd，ms）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding SelectedSong.AudioPreviewEnd, UpdateSourceTrigger=PropertyChanged}" />
                                </Grid>
                            </GroupBox>

                            <GroupBox Header="限制 / 分类">
                                <Grid Margin="4">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="购买方式（purchase）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedSong.Purchase, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="日期（date，Unix）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedSong.Date, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="版本分类（version）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedSong.Version, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="隐藏直到（hidden_until）" Style="{StaticResource FieldLabelText}" />
                                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedSong.HiddenUntil, UpdateSourceTrigger=PropertyChanged}" />

                                    <WrapPanel Grid.Row="4" Grid.Column="1" ItemHeight="26">
                                        <CheckBox Content="远程下载（remote_dl）" IsChecked="{Binding SelectedSong.RemoteDownload}" Margin="0,0,12,6" />
                                        <CheckBox Content="世界解锁（world_unlock）" IsChecked="{Binding SelectedSong.WorldUnlock}" Margin="0,0,12,6" />
                                        <CheckBox Content="BYD 本地解锁（byd_local_unlock）" IsChecked="{Binding SelectedSong.BeyondLocalUnlock}" Margin="0,0,12,6" />
                                        <CheckBox Content="禁止直播（no_stream）" IsChecked="{Binding SelectedSong.NoStream}" Margin="0,0,12,6" />
                                    </WrapPanel>
                                </Grid>
                            </GroupBox>

                            <GroupBox Header="难度（difficulties）">
                                <StackPanel>
                                    <WrapPanel Margin="0,0,0,8">
                                        <Button Content="添加难度" Command="{Binding AddDifficultyCommand}" Margin="0,0,8,0" />
                                        <Button Content="删除选中难度" Command="{Binding RemoveSelectedDifficultyCommand}" />
                                    </WrapPanel>

                                    <DataGrid ItemsSource="{Binding SelectedDifficulties}"
                                              SelectedItem="{Binding SelectedDifficulty}"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="False"
                                              CanUserAddRows="False"
                                              CanUserDeleteRows="False"
                                              HeadersVisibility="Column">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="难度" Binding="{Binding RatingClass}" Width="90" />
                                            <DataGridTextColumn Header="等级" Binding="{Binding Rating}" Width="70" />
                                            <DataGridCheckBoxColumn Header="+" Binding="{Binding RatingPlus}" Width="60" />
                                            <DataGridTextColumn Header="谱师" Binding="{Binding ChartDesigner}" Width="160" />
                                            <DataGridTextColumn Header="曲绘" Binding="{Binding JacketDesigner}" Width="160" />
                                            <DataGridCheckBoxColumn Header="世界解锁" Binding="{Binding WorldUnlock}" Width="90" />
                                            <DataGridCheckBoxColumn Header="曲绘覆盖" Binding="{Binding JacketOverride}" Width="90" />
                                            <DataGridCheckBoxColumn Header="音频覆盖" Binding="{Binding AudioOverride}" Width="90" />
                                            <DataGridTextColumn Header="隐藏直到" Binding="{Binding HiddenUntil}" Width="140" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>
                    </ScrollViewer>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                        <Button Content="保存更改"
                                Style="{StaticResource PrimaryButton}"
                                Command="{Binding EditSongCommand}" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
