<Page x:Class="ArcaeaSonglistEditor.Views.ToolsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:viewModels="clr-namespace:ArcaeaSonglistEditor.ViewModels"
      Title="工具"
      Width="Auto"
      Height="Auto">
    

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <TextBlock Grid.Row="0"
                   Text="工具"
                   Style="{StaticResource PageTitleText}" />

        <!-- 工具列表 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Orientation="Vertical">
            <!-- 批量操作 -->
            <GroupBox Header="批量操作">
                <StackPanel Orientation="Vertical">
                    <Button Content="移除所有歌曲限制"
                            Margin="0,0,0,10"
                            Command="{Binding RemoveAllSongRestrictionsCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="移除所有歌曲限制" FontWeight="Bold" />
                                    <TextBlock Text="功能：批量移除所有歌曲的各种限制条件，包括：" />
                                    <TextBlock Text="• 购买限制 (purchase)" Margin="10,0,0,0" />
                                    <TextBlock Text="• 远程下载限制 (remote_dl)" Margin="10,0,0,0" />
                                    <TextBlock Text="• 世界解锁限制 (world_unlock)" Margin="10,0,0,0" />
                                    <TextBlock Text="• BYD本地解锁限制 (byd_local_unlock)" Margin="10,0,0,0" />
                                    <TextBlock Text="• 无流媒体限制 (no_stream)" Margin="10,0,0,0" />
                                    <TextBlock Text="• 隐藏直到限制 (hidden_until)" Margin="10,0,0,0" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="清空所有解锁条件"
                            Margin="0,0,0,10"
                            Command="{Binding ClearAllUnlockConditionsCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="清空所有解锁条件" FontWeight="Bold" />
                                    <TextBlock Text="功能：删除所有解锁条件条目，使所有歌曲默认可用。" />
                                    <TextBlock Text="注意：这将移除所有类型的解锁条件，包括：" />
                                    <TextBlock Text="• 歌曲解锁条件" Margin="10,0,0,0" />
                                    <TextBlock Text="• 曲包解锁条件" Margin="10,0,0,0" />
                                    <TextBlock Text="• 角色解锁条件" Margin="10,0,0,0" />
                                    <TextBlock Text="• 世界模式解锁条件" Margin="10,0,0,0" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                </StackPanel>
            </GroupBox>


            <!-- 验证工具 -->
            <GroupBox Header="验证工具">
                <StackPanel Orientation="Vertical">
                    <Button Content="检查重复歌曲"
                            Command="{Binding CheckDuplicateSongsCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="检查重复歌曲" FontWeight="Bold" />
                                    <TextBlock Text="功能：检查歌曲列表中是否有重复的歌曲ID。" />
                                    <TextBlock Text="重复的歌曲ID会导致游戏加载错误，必须修复。" />
                                    <TextBlock Text="检查标准：歌曲ID (id字段) 必须唯一" />
                                    <TextBlock Text="输出：列出所有重复的歌曲ID和出现次数" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="检查缺失曲包"
                            Command="{Binding CheckMissingPacksCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="检查缺失曲包" FontWeight="Bold" />
                                    <TextBlock Text="功能：检查歌曲引用的曲包是否在曲包列表中定义。" />
                                    <TextBlock Text="歌曲通过set字段引用曲包，如果曲包不存在会导致游戏错误。" />
                                    <TextBlock Text="检查标准：所有歌曲的set字段必须在曲包列表中有对应条目" />
                                    <TextBlock Text="输出：列出所有缺失的曲包ID" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="检查无效解锁条件"
                            Command="{Binding CheckInvalidUnlockConditionsCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="检查无效解锁条件" FontWeight="Bold" />
                                    <TextBlock Text="功能：检查解锁条件中引用的歌曲是否存在，以及条件参数是否有效。" />
                                    <TextBlock Text="无效的解锁条件会导致游戏崩溃或解锁功能异常。" />
                                    <TextBlock Text="检查内容：" />
                                    <TextBlock Text="• 引用的歌曲ID是否存在" Margin="10,0,0,0" />
                                    <TextBlock Text="• 解锁条件类型是否有效 (0-106)" Margin="10,0,0,0" />
                                    <TextBlock Text="• 条件参数是否在有效范围内" Margin="10,0,0,0" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>
            </GroupBox>

            <!-- Bundle封包工具 -->
            <GroupBox Header="Bundle封包工具">
                <StackPanel Orientation="Vertical">
                    <Button Content="验证active文件夹结构"
                            Margin="0,0,0,10"
                            Command="{Binding ValidateActiveFolderCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="验证active文件夹结构" FontWeight="Bold" />
                                    <TextBlock Text="功能：验证active文件夹是否符合Arcaea Bundle要求。" />
                                    <TextBlock Text="验证内容：" />
                                    <TextBlock Text="• 检查songlist、packlist、unlocks文件是否存在" Margin="10,0,0,0" />
                                    <TextBlock Text="• 检查歌曲文件夹结构是否正确" Margin="10,0,0,0" />
                                    <TextBlock Text="• 检查img文件夹是否存在" Margin="10,0,0,0" />
                                    <TextBlock Text="用途：在生成meta.cb前确保文件夹结构正确" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="更新现有active文件夹"
                            Margin="0,0,0,10"
                            Command="{Binding UpdateActiveFolderCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="更新现有active文件夹" FontWeight="Bold" />
                                    <TextBlock Text="功能：将当前编辑的歌曲、曲包、解锁条件数据更新到现有的active文件夹。" />
                                    <TextBlock Text="更新内容：" />
                                    <TextBlock Text="• songs/songlist 文件" Margin="10,0,0,0" />
                                    <TextBlock Text="• songs/packlist 文件" Margin="10,0,0,0" />
                                    <TextBlock Text="• songs/unlocks 文件" Margin="10,0,0,0" />
                                    <TextBlock Text="注意：只更新清单文件，不修改音频和图片文件" />
                                    <TextBlock Text="用途：在修改清单后重新打包时使用" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="生成meta.cb文件"
                            Margin="0,0,0,10"
                            Command="{Binding GenerateMetaCbCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="生成meta.cb文件" FontWeight="Bold" />
                                    <TextBlock Text="功能：为active文件夹生成meta.cb校验文件。" />
                                    <TextBlock Text="生成内容：" />
                                    <TextBlock Text="• 文件列表和SHA256哈希" Margin="10,0,0,0" />
                                    <TextBlock Text="• 版本信息 (applicationVersionNumber, versionNumber)" Margin="10,0,0,0" />
                                    <TextBlock Text="• UUID和增量更新信息" Margin="10,0,0,0" />
                                    <TextBlock Text="用途：游戏客户端使用此文件验证资源完整性" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="验证bundle匹配性"
                            Margin="0,0,0,10"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding ValidateBundleCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="验证bundle匹配性" FontWeight="Bold" />
                                    <TextBlock Text="功能：验证meta.cb文件和active文件夹的内容是否匹配。" />
                                    <TextBlock Text="验证内容：" />
                                    <TextBlock Text="• 验证所有文件的SHA256哈希是否匹配" Margin="10,0,0,0" />
                                    <TextBlock Text="• 验证三个清单文件的HMAC-SHA256哈希" Margin="10,0,0,0" />
                                    <TextBlock Text="• 验证版本信息和文件列表" Margin="10,0,0,0" />
                                    <TextBlock Text="用途：确保打包后的bundle可以通过游戏客户端验证" />
                                    <TextBlock Text="算法：基于Arcaea-Bundler的校验逻辑" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="完整的bundle封包流程"
                            FontWeight="Bold"
                            Style="{StaticResource SuccessButton}"
                            Command="{Binding CreateCompleteBundleCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="完整的bundle封包流程" FontWeight="Bold" />
                                    <TextBlock Text="功能：执行完整的bundle封包流程，包括：" />
                                    <TextBlock Text="1. 选择现有的active文件夹" Margin="10,0,0,0" />
                                    <TextBlock Text="2. 更新active文件夹中的清单文件" Margin="10,0,0,0" />
                                    <TextBlock Text="3. 验证active文件夹结构" Margin="10,0,0,0" />
                                    <TextBlock Text="4. 生成meta.cb文件" Margin="10,0,0,0" />
                                    <TextBlock Text="用途：一键完成所有bundle封包步骤" />
                                    <TextBlock Text="注意：需要提供版本信息" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>
            </GroupBox>

            <!-- DL文件夹工具 -->
            <GroupBox Header="DL文件夹工具">
                <StackPanel Orientation="Vertical">
                    <Button Content="验证DL文件夹结构"
                            Margin="0,0,0,10"
                            Command="{Binding ValidateDlFolderCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="验证DL文件夹结构" FontWeight="Bold" />
                                    <TextBlock Text="功能：验证Arcaea的dl文件夹结构，分析其中的资源文件。" />
                                    <TextBlock Text="验证内容：" />
                                    <TextBlock Text="• 分析dl文件夹中的文件命名规则" Margin="10,0,0,0" />
                                    <TextBlock Text="• 识别音频文件、谱面文件、视频文件等" Margin="10,0,0,0" />
                                    <TextBlock Text="• 检查歌曲是否在songlist中" Margin="10,0,0,0" />
                                    <TextBlock Text="• 统计每个歌曲的资源完整性" Margin="10,0,0,0" />
                                    <TextBlock Text="用途：在导入前了解dl文件夹的内容和结构" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    
                    <Button Content="填充dl_前缀文件夹"
                            Margin="0,0,0,10"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding FillDlFoldersCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="填充dl_前缀文件夹" FontWeight="Bold" />
                                    <TextBlock Text="功能：从dl文件夹中查找资源并填充dl_前缀文件夹。" />
                                    <TextBlock Text="填充流程：" />
                                    <TextBlock Text="1. 选择dl文件夹（包含下载的资源文件）" Margin="10,0,0,0" />
                                    <TextBlock Text="2. 选择songs文件夹（包含dl_前缀文件夹）" Margin="10,0,0,0" />
                                    <TextBlock Text="3. 自动查找并填充对应的资源文件" Margin="10,0,0,0" />
                                    <TextBlock Text="4. 如果文件夹资源完整，自动移除dl_前缀" Margin="10,0,0,0" />
                                    <TextBlock Text="用途：将远程下载的歌曲转换为本地完整资源" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                    
                    <Button Content="从DL文件夹导入资源"
                            FontWeight="Bold"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding ImportFromDlFolderCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="从DL文件夹导入资源" FontWeight="Bold" />
                                    <TextBlock Text="功能：将Arcaea的dl文件夹中的资源导入到songs文件夹。" />
                                    <TextBlock Text="导入流程：" />
                                    <TextBlock Text="1. 选择dl文件夹（包含下载的资源文件）" Margin="10,0,0,0" />
                                    <TextBlock Text="2. 选择目标songs文件夹（通常在active/songs下）" Margin="10,0,0,0" />
                                    <TextBlock Text="3. 自动识别文件类型并重命名" Margin="10,0,0,0" />
                                    <TextBlock Text="4. 创建歌曲文件夹并复制文件" Margin="10,0,0,0" />
                                    <TextBlock Text="文件映射：" />
                                    <TextBlock Text="• 歌曲名 → base.ogg（音频文件）" Margin="10,0,0,0" />
                                    <TextBlock Text="• 歌曲名_数字 → 数字.aff（谱面文件）" Margin="10,0,0,0" />
                                    <TextBlock Text="• 歌曲名_video_audio.ogg → video_audio.ogg" Margin="10,0,0,0" />
                                    <TextBlock Text="• 歌曲名_video.mp4 → video.mp4" Margin="10,0,0,0" />
                                    <TextBlock Text="用途：将下载的资源转换为Arcaea可用的格式" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>
            </GroupBox>

            <!-- 高级工具 -->
            <GroupBox Header="高级工具">
                <StackPanel Orientation="Vertical">
                    <Button Content="清理临时文件"
                            Command="{Binding CleanTempFilesCommand}">
                        <Button.ToolTip>
                            <ToolTip>
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="清理临时文件" FontWeight="Bold" />
                                    <TextBlock Text="功能：清理应用程序在临时目录中生成的文件。" />
                                    <TextBlock Text="清理范围：系统临时目录中所有以arcaea_开头的.tmp文件" />
                                    <TextBlock Text="注意：这不会删除日志文件或用户数据" />
                                    <TextBlock Text="建议：定期清理以释放磁盘空间" />
                                </StackPanel>
                            </ToolTip>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>
            </GroupBox>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
